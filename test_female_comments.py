#!/usr/bin/env python
# -*- coding: utf-8 -*-
"""
–¢–µ—Å—Ç –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤ –æ—Ç –∂–µ–Ω—Å–∫–æ–≥–æ –ª–∏—Ü–∞
"""

import os
import sys
from dotenv import load_dotenv

load_dotenv()

# –ü—Ä–æ–≤–µ—Ä—è–µ–º API –∫–ª—é—á–∏
YANDEX_API_KEY = os.getenv('YC_API_KEY') or os.getenv('YANDEX_API_KEY', '')
YANDEX_FOLDER_ID = os.getenv('YC_FOLDER_ID') or os.getenv('YANDEX_FOLDER_ID', '')

if not YANDEX_API_KEY:
    print("‚ùå –û–®–ò–ë–ö–ê: YC_API_KEY –Ω–µ –∑–∞–¥–∞–Ω –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è")
    print("   –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ YC_API_KEY –≤ .env —Ñ–∞–π–ª–µ –∏–ª–∏ —á–µ—Ä–µ–∑ export")
    sys.exit(1)

# Import the updated function
from main import generate_neuro_comment

print("="*80)
print("üß™ –¢–ï–°–¢ –ö–û–ú–ú–ï–ù–¢–ê–†–ò–ï–í –û–¢ –ñ–ï–ù–°–ö–û–ì–û –õ–ò–¶–ê (–æ–±–Ω–æ–≤–ª—ë–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è)")
print("="*80)
print("\nüìã –ß—Ç–æ –ø—Ä–æ–≤–µ—Ä—è–µ–º:")
print("   ‚úì –ñ–µ–Ω—Å–∫–∏–π —Ä–æ–¥ (–≤–∏–¥–µ–ª–∞, –¥—É–º–∞–ª–∞, –ø–æ–ø—Ä–æ–±–æ–≤–∞–ª–∞)")
print("   ‚úì –≠–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å –∏ –∂–∏–≤–æ—Å—Ç—å")
print("   ‚úì –†–∞–∑–Ω–æ–æ–±—Ä–∞–∑–∏–µ —Å—Ç–∏–ª–µ–π")
print("   ‚úì –ö–æ–Ω–∫—Ä–µ—Ç–∏–∫–∞ –∏–∑ –ø–æ—Å—Ç–æ–≤")
print()

test_cases = [
    {
        "post_text": "Python 3.12 –≤—ã—à–µ–ª —Å —É–ª—É—á—à–µ–Ω–Ω–æ–π –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å—é –Ω–∞ 40%. –ù–æ–≤—ã–π JIT-–∫–æ–º–ø–∏–ª—è—Ç–æ—Ä —É—Å–∫–æ—Ä—è–µ—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∫–æ–¥–∞.",
        "channel_theme": "–ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏–µ",
        "expected": "–∂–µ–Ω—Å–∫–∏–π —Ä–æ–¥ + —É–ø–æ–º–∏–Ω–∞–Ω–∏–µ —Ü–∏—Ñ—Ä"
    },
    {
        "post_text": "–°–µ–≥–æ–¥–Ω—è –ø—Ä–µ–∫—Ä–∞—Å–Ω–∞—è –ø–æ–≥–æ–¥–∞! –°–æ–ª–Ω—Ü–µ —Å–≤–µ—Ç–∏—Ç, —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ +25¬∞C. –ò–¥–µ–∞–ª—å–Ω—ã–π –¥–µ–Ω—å –¥–ª—è –ø—Ä–æ–≥—É–ª–∫–∏ –≤ –ø–∞—Ä–∫–µ.",
        "channel_theme": "–æ–±—â–µ–Ω–∏–µ",
        "expected": "–∂–µ–Ω—Å–∫–∏–π —Ä–æ–¥ + —ç–º–æ—Ü–∏—è"
    },
    {
        "post_text": "–†–µ—Ü–µ–ø—Ç –∏–¥–µ–∞–ª—å–Ω–æ–π –ø–∞—Å—Ç—ã –∫–∞—Ä–±–æ–Ω–∞—Ä–∞: 200–≥ —Å–ø–∞–≥–µ—Ç—Ç–∏, 100–≥ –≥—É–∞–Ω—á–∏–∞–ª–µ, 2 —è–π—Ü–∞, –ø–∞—Ä–º–µ–∑–∞–Ω. –ì–æ—Ç–æ–≤–∏—Ç—Å—è –∑–∞ 15 –º–∏–Ω—É—Ç!",
        "channel_theme": "–∫—É–ª–∏–Ω–∞—Ä–∏—è",
        "expected": "–∂–µ–Ω—Å–∫–∏–π —Ä–æ–¥ + –ª–∏—á–Ω—ã–π –æ–ø—ã—Ç/–≤–æ–ø—Ä–æ—Å"
    },
    {
        "post_text": "–û—Ç–∫—Ä—ã–ª–∞ —Å–≤–æ–π –ø–µ—Ä–≤—ã–π –±–∏–∑–Ω–µ—Å –≤ 23 –≥–æ–¥–∞. –ß–µ—Ä–µ–∑ –≥–æ–¥ –≤—ã—Ä—É—á–∫–∞ –¥–æ—Å—Ç–∏–≥–ª–∞ 5 –º–∏–ª–ª–∏–æ–Ω–æ–≤ —Ä—É–±–ª–µ–π. –ì–ª–∞–≤–Ω–æ–µ - –Ω–µ –±–æ—è—Ç—å—Å—è —Ä–∏—Å–∫–æ–≤–∞—Ç—å!",
        "channel_theme": "–±–∏–∑–Ω–µ—Å",
        "expected": "–∂–µ–Ω—Å–∫–∏–π —Ä–æ–¥ + –≤–æ—Å—Ö–∏—â–µ–Ω–∏–µ/–ø–æ–¥–¥–µ—Ä–∂–∫–∞"
    },
    {
        "post_text": "–ú–µ–¥–∏—Ç–∞—Ü–∏—è –ø–æ 10 –º–∏–Ω—É—Ç —É—Ç—Ä–æ–º –∏–∑–º–µ–Ω–∏–ª–∞ –º–æ—é –∂–∏–∑–Ω—å. –°–Ω–∏–∑–∏–ª—Å—è —Å—Ç—Ä–µ—Å—Å, —É–ª—É—á—à–∏–ª—Å—è —Å–æ–Ω. –†–µ–∫–æ–º–µ–Ω–¥—É—é –≤—Å–µ–º –ø–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å!",
        "channel_theme": "—Å–∞–º–æ—Ä–∞–∑–≤–∏—Ç–∏–µ",
        "expected": "–∂–µ–Ω—Å–∫–∏–π —Ä–æ–¥ + —Ä–µ–∑–æ–Ω–∞–Ω—Å/–æ–ø—ã—Ç"
    },
]

print("üîÑ –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏...\n")

results = []
for i, test_case in enumerate(test_cases, 1):
    print(f"{'='*80}")
    print(f"üìù –¢–µ—Å—Ç {i}/5")
    print(f"{'='*80}")
    print(f"üìÑ –ü–æ—Å—Ç: {test_case['post_text'][:70]}...")
    print(f"üè∑Ô∏è  –¢–µ–º–∞: {test_case['channel_theme']}")
    print(f"üéØ –û–∂–∏–¥–∞–µ—Ç—Å—è: {test_case['expected']}")
    print()
    
    # –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º 3 –≤–∞—Ä–∏–∞–Ω—Ç–∞ –¥–ª—è —Ä–∞–∑–Ω–æ–æ–±—Ä–∞–∑–∏—è
    comments = []
    for j in range(3):
        try:
            comment = generate_neuro_comment(
                post_text=test_case['post_text'],
                channel_theme=test_case['channel_theme']
            )
            comments.append(comment)
            
            # –ü—Ä–æ–≤–µ—Ä—è–µ–º –∂–µ–Ω—Å–∫–∏–π —Ä–æ–¥
            male_words = ['–≤–∏–¥–µ–ª', '–¥—É–º–∞–ª', '–ø–æ–Ω—è–ª', '—á–∏—Ç–∞–ª', '—Å–º–æ—Ç—Ä–µ–ª', '–ø—Ä–æ–±–æ–≤–∞–ª', '—Å–¥–µ–ª–∞–ª', '–Ω–∞–ø–∏—Å–∞–ª']
            has_male_form = any(word in comment.lower() for word in male_words)
            
            status = "‚úÖ" if not has_male_form else "‚ö†Ô∏è (–º—É–∂—Å–∫–æ–π —Ä–æ–¥!)"
            print(f"   {j+1}. {status} {comment}")
            
        except Exception as e:
            print(f"   ‚ùå –û—à–∏–±–∫–∞: {e}")
            comments.append(None)
    
    results.append({
        'case': test_case,
        'comments': comments
    })
    print()

print("="*80)
print("üìä –ò–¢–û–ì–û–í–ê–Ø –°–¢–ê–¢–ò–°–¢–ò–ö–ê")
print("="*80)

total_comments = sum(len([c for c in r['comments'] if c]) for r in results)
print(f"\n‚úÖ –£—Å–ø–µ—à–Ω–æ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–æ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤: {total_comments}/{len(test_cases)*3}")

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –∂–µ–Ω—Å–∫–∏–π —Ä–æ–¥
all_comments = [c for r in results for c in r['comments'] if c]
male_words = ['–≤–∏–¥–µ–ª', '–¥—É–º–∞–ª', '–ø–æ–Ω—è–ª', '—á–∏—Ç–∞–ª', '—Å–º–æ—Ç—Ä–µ–ª', '–ø—Ä–æ–±–æ–≤–∞–ª', '—Å–¥–µ–ª–∞–ª', '–Ω–∞–ø–∏—Å–∞–ª']
comments_with_male = [c for c in all_comments if any(word in c.lower() for word in male_words)]

if comments_with_male:
    print(f"\n‚ö†Ô∏è  –ù–∞–π–¥–µ–Ω–æ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤ —Å –º—É–∂—Å–∫–∏–º —Ä–æ–¥–æ–º: {len(comments_with_male)}/{total_comments}")
    print("   –ü—Ä–æ–±–ª–µ–º–Ω—ã–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏:")
    for c in comments_with_male[:3]:
        print(f"   - {c}")
else:
    print(f"\n‚úÖ –í—Å–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –≤ –∂–µ–Ω—Å–∫–æ–º —Ä–æ–¥–µ! üéâ")

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —ç–º–æ–¥–∑–∏
comments_with_emoji = [c for c in all_comments if any(ord(ch) > 127000 for ch in c)]
print(f"\nüìä –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤ —Å —ç–º–æ–¥–∑–∏: {len(comments_with_emoji)}/{total_comments} ({len(comments_with_emoji)*100//total_comments}%)")

# –°—Ä–µ–¥–Ω—è—è –¥–ª–∏–Ω–∞
avg_length = sum(len(c.split()) for c in all_comments) / len(all_comments)
print(f"üìè –°—Ä–µ–¥–Ω—è—è –¥–ª–∏–Ω–∞: {avg_length:.1f} —Å–ª–æ–≤")

print("\n" + "="*80)
print("‚ú® –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï –ó–ê–í–ï–†–®–ï–ù–û!")
print("="*80)
print("\nüí° –°–æ–≤–µ—Ç—ã –ø–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ:")
print("   ‚Ä¢ –ï—Å–ª–∏ –º–Ω–æ–≥–æ –º—É–∂—Å–∫–æ–≥–æ —Ä–æ–¥–∞ - –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–æ–º–ø—Ç –≤ main.py")
print("   ‚Ä¢ –ï—Å–ª–∏ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ —Å—É—Ö–∏–µ - —É–≤–µ–ª–∏—á—å—Ç–µ temperature (—Å–µ–π—á–∞—Å 0.85)")
print("   ‚Ä¢ –ï—Å–ª–∏ —Å–ª–∏—à–∫–æ–º –∫–æ—Ä–æ—Ç–∫–∏–µ - —É–≤–µ–ª–∏—á—å—Ç–µ max_tokens (—Å–µ–π—á–∞—Å 130)")
print("   ‚Ä¢ –î–ª—è –±–æ–ª—å—à–µ–≥–æ —Ä–∞–∑–Ω–æ–æ–±—Ä–∞–∑–∏—è –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –±–æ–ª—å—à–µ —Ç–∏–ø–æ–≤ —Ä–µ–∞–∫—Ü–∏–π")
print("\nüîß –î–ª—è –æ—Ç–ª–∞–¥–∫–∏ –ø—Ä–æ–º–ø—Ç–æ–≤:")
print("   export LOG_COMMENTS=true")
print("   python test_female_comments.py")
