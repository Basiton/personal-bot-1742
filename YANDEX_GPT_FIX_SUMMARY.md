# –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∏ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ YandexGPT

## –ß—Ç–æ –±—ã–ª–æ —Å–¥–µ–ª–∞–Ω–æ

### ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–æ –ø–æ–¥—Ä–æ–±–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ –±–æ—Ç–∞

**–ì–¥–µ:** [main.py](main.py#L448-L491) (–≤ –º–µ—Ç–æ–¥–µ `__init__` –∫–ª–∞—Å—Å–∞ `UltimateCommentBot`)

–ü—Ä–∏ –∑–∞–ø—É—Å–∫–µ –±–æ—Ç–∞ —Ç–µ–ø–µ—Ä—å –≤—ã–≤–æ–¥–∏—Ç—Å—è –¥–µ—Ç–∞–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è:
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è `YC_API_KEY` –∏–ª–∏ `YANDEX_API_KEY`
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è `YC_FOLDER_ID` –∏–ª–∏ `YANDEX_FOLDER_ID`
- –ó–∞–º–∞—Å–∫–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –∫–ª—é—á–∞ (–ø–µ—Ä–≤—ã–µ 8 –∏ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 4 —Å–∏–º–≤–æ–ª–∞)
- –ò—Å—Ç–æ—á–Ω–∏–∫ –∫–∞–∂–¥–æ–π –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π
- –ò—Ç–æ–≥–æ–≤—ã–π —Å—Ç–∞—Ç—É—Å: –≤–∫–ª—é—á—ë–Ω –∏–ª–∏ –æ—Ç–∫–ª—é—á—ë–Ω YandexGPT
- Model URI –∏ endpoint

### ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–æ –¥–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–∞–∂–¥–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞ –∫ YandexGPT

**–ì–¥–µ:** [main.py](main.py#L184-L276) (–≤ —Ñ—É–Ω–∫—Ü–∏–∏ `generate_neuro_comment`)

–ü—Ä–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è –ª–æ–≥–∏—Ä—É–µ—Ç—Å—è:
- Model URI –∏ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã (temperature, max_tokens)
- –î–ª–∏–Ω–∞ –ø—Ä–æ–º–ø—Ç–∞ –∏ —Ç–µ–∫—Å—Ç–∞ –ø–æ—Å—Ç–∞
- –¢–µ–º–∞ –∫–∞–Ω–∞–ª–∞
- –°—Ç–∞—Ç—É—Å –æ—Ç–ø—Ä–∞–≤–∫–∏ –∑–∞–ø—Ä–æ—Å–∞
- HTTP —Å—Ç–∞—Ç—É—Å –æ—Ç–≤–µ—Ç–∞
- –°—ã—Ä–æ–π –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –æ—Ç API
- –§–∏–Ω–∞–ª—å–Ω—ã–π –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –ø–æ—Å–ª–µ –ø–æ—Å—Ç–æ–±—Ä–∞–±–æ—Ç–∫–∏

### ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø–æ–¥—Ä–æ–±–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

–ü—Ä–∏ –æ—à–∏–±–∫–∞—Ö API —Ç–µ–ø–µ—Ä—å –ª–æ–≥–∏—Ä—É–µ—Ç—Å—è:
- HTTP —Å—Ç–∞—Ç—É—Å –∫–æ–¥
- –ó–∞–≥–æ–ª–æ–≤–∫–∏ –∏ —Ç–µ–ª–æ –æ—Ç–≤–µ—Ç–∞
- **–î–µ—Ç–∞–ª—å–Ω–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –ø—Ä–∏—á–∏–Ω—ã:**
  - 400: –ù–µ–≤–µ—Ä–Ω—ã–π –∑–∞–ø—Ä–æ—Å (folder_id –∏–ª–∏ —Ñ–æ—Ä–º–∞—Ç)
  - 401: –ù–µ–≤–µ—Ä–Ω—ã–π API –∫–ª—é—á
  - 403: –ù–µ—Ç –ø—Ä–∞–≤ –Ω–∞ folder_id
  - 429: –ü—Ä–µ–≤—ã—à–µ–Ω rate limit
  - Timeout: API –Ω–µ –æ—Ç–≤–µ—Ç–∏–ª –∑–∞ 30 —Å–µ–∫—É–Ω–¥
  - ConnectionError: –ü—Ä–æ–±–ª–µ–º—ã —Å —Å–µ—Ç—å—é

### ‚úÖ –£–ª—É—á—à–µ–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∏—Å–∫–ª—é—á–µ–Ω–∏–π

- –û—Ç–¥–µ–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ `json.JSONDecodeError` (–Ω–µ–≤–∞–ª–∏–¥–Ω—ã–π JSON)
- –û—Ç–¥–µ–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ `KeyError` (–Ω–µ–æ–∂–∏–¥–∞–Ω–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –æ—Ç–≤–µ—Ç–∞)
- –û—Ç–¥–µ–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ `requests.exceptions.Timeout`
- –û—Ç–¥–µ–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ `requests.exceptions.ConnectionError`
- –ü–æ–ª–Ω—ã–π traceback –¥–ª—è –Ω–µ–∏–∑–≤–µ—Å—Ç–Ω—ã—Ö –æ—à–∏–±–æ–∫

### ‚úÖ –°–æ–∑–¥–∞–Ω–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

1. **[YANDEX_GPT_DIAGNOSTICS.md](YANDEX_GPT_DIAGNOSTICS.md)** ‚Äî –ø–æ–¥—Ä–æ–±–Ω–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–µ
2. **[comapc-bot.service.example](comapc-bot.service.example)** ‚Äî –ø—Ä–∏–º–µ—Ä –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ systemd unit

## –ö–∞–∫–∏–µ —Å—Ç—Ä–æ–∫–∏ —Å–º–æ—Ç—Ä–µ—Ç—å –≤ –ª–æ–≥–∞—Ö

### –ü—Ä–∏ –∑–∞–ø—É—Å–∫–µ –±–æ—Ç–∞

```bash
sudo journalctl -u comapc-bot --since "5 minutes ago" | grep -A 15 "–ü–†–û–í–ï–†–ö–ê YANDEX GPT"
```

**–ß—Ç–æ –∏—Å–∫–∞—Ç—å:**
- `‚úÖ YC_API_KEY –Ω–∞–π–¥–µ–Ω` –∏–ª–∏ `‚ùå API KEY –ù–ï –ù–ê–ô–î–ï–ù`
- `‚úÖ YC_FOLDER_ID –Ω–∞–π–¥–µ–Ω` –∏–ª–∏ `‚ö†Ô∏è FOLDER_ID –Ω–µ –Ω–∞–π–¥–µ–Ω`
- `‚úÖ YANDEX GPT: –í–ö–õ–Æ–ß–Å–ù` –∏–ª–∏ `‚ùå YANDEX GPT: –û–¢–ö–õ–Æ–ß–Å–ù`

### –ü—Ä–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤

```bash
sudo journalctl -u comapc-bot -f | grep -E "YANDEX GPT|YandexGPT"
```

**–ß—Ç–æ –∏—Å–∫–∞—Ç—å:**
- `ü§ñ YANDEX GPT: –Ω–∞—á–∏–Ω–∞–µ–º –≥–µ–Ω–µ—Ä–∞—Ü–∏—é` ‚Äî –Ω–∞—á–∞–ª–æ –∑–∞–ø—Ä–æ—Å–∞
- `üì° –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∑–∞–ø—Ä–æ—Å –∫ YandexGPT API` ‚Äî –∑–∞–ø—Ä–æ—Å –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω
- `üì• –ü–æ–ª—É—á–µ–Ω –æ—Ç–≤–µ—Ç –æ—Ç YandexGPT: HTTP 200` ‚Äî —É—Å–ø–µ—à–Ω—ã–π –æ—Ç–≤–µ—Ç
- `üéâ YandexGPT: –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π —É—Å–ø–µ—à–Ω–æ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω` ‚Äî —É—Å–ø–µ—Ö
- `‚ùå YandexGPT API error: HTTP XXX` ‚Äî –æ—à–∏–±–∫–∞ API
- `‚ö†Ô∏è –ò—Å–ø–æ–ª—å–∑—É—é fallback —à–∞–±–ª–æ–Ω—ã` ‚Äî –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –Ω–∞ —à–∞–±–ª–æ–Ω—ã

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∏—á–∏–Ω—ã –ø—Ä–æ–±–ª–µ–º—ã

```bash
# –û—à–∏–±–∫–∏ API
sudo journalctl -u comapc-bot --since "1 hour ago" | grep -B 2 -A 5 "‚ùå.*YandexGPT"

# –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —É—Å–ø–µ—Ö–∞
echo "–£—Å–ø–µ—à–Ω—ã—Ö YandexGPT:"
sudo journalctl -u comapc-bot --since "1 hour ago" | grep -c "—É—Å–ø–µ—à–Ω–æ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω"
echo "Fallback —à–∞–±–ª–æ–Ω–æ–≤:"
sudo journalctl -u comapc-bot --since "1 hour ago" | grep -c "–ò—Å–ø–æ–ª—å–∑—É—é fallback"
```

## –í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã –∏ —Ä–µ—à–µ–Ω–∏—è

### –ü—Ä–æ–±–ª–µ–º–∞ 1: "‚ùå API KEY –ù–ï –ù–ê–ô–î–ï–ù"

**–ü—Ä–∏—á–∏–Ω–∞:** –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã –≤ systemd unit

**–†–µ—à–µ–Ω–∏–µ:**
1. –û—Ç–∫—Ä–æ–π—Ç–µ `/etc/systemd/system/comapc-bot.service`
2. –î–æ–±–∞–≤—å—Ç–µ –≤ —Å–µ–∫—Ü–∏—é `[Service]`:
   ```
   Environment="YC_API_KEY=–≤–∞—à_–∫–ª—é—á"
   Environment="YC_FOLDER_ID=–≤–∞—à_folder_id"
   ```
3. –ü—Ä–∏–º–µ–Ω–∏—Ç–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è:
   ```bash
   sudo systemctl daemon-reload
   sudo systemctl restart comapc-bot
   ```

### –ü—Ä–æ–±–ª–µ–º–∞ 2: "‚ùå YandexGPT API error: HTTP 401"

**–ü—Ä–∏—á–∏–Ω–∞:** –ù–µ–≤–µ—Ä–Ω—ã–π API –∫–ª—é—á

**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–ª—é—á –≤ Yandex Cloud Console
2. –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ –∫–ª—é—á –ø–æ–ª–Ω—ã–π (–Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å `AQVN...`)
3. –û–±–Ω–æ–≤–∏—Ç–µ –≤ systemd unit
4. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ –±–æ—Ç–∞

### –ü—Ä–æ–±–ª–µ–º–∞ 3: "‚ùå YandexGPT API error: HTTP 403"

**–ü—Ä–∏—á–∏–Ω–∞:** –ù–µ—Ç –ø—Ä–∞–≤ –Ω–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ folder

**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ —Å–µ—Ä–≤–∏—Å–Ω—ã–π –∞–∫–∫–∞—É–Ω—Ç –∏–º–µ–µ—Ç —Ä–æ–ª—å `ai.languageModels.user`
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ `YC_FOLDER_ID` –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π
3. –í Yandex Cloud Console: IAM ‚Üí –°–µ—Ä–≤–∏—Å–Ω—ã–µ –∞–∫–∫–∞—É–Ω—Ç—ã ‚Üí –†–æ–ª–∏

### –ü—Ä–æ–±–ª–µ–º–∞ 4: "‚ùå YandexGPT API error: HTTP 400"

**–ü—Ä–∏—á–∏–Ω–∞:** –ù–µ–≤–µ—Ä–Ω—ã–π folder_id –∏–ª–∏ —Ñ–æ—Ä–º–∞—Ç –∑–∞–ø—Ä–æ—Å–∞

**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ `YC_FOLDER_ID` (–¥–æ–ª–∂–µ–Ω –Ω–∞—á–∏–Ω–∞—Ç—å—Å—è —Å `b1g...`)
2. –í –∫–æ–Ω—Å–æ–ª–∏ YC: —Å–∫–æ–ø–∏—Ä—É–π—Ç–µ ID –∫–∞—Ç–∞–ª–æ–≥–∞ –∏–∑ –≤–µ—Ä—Ö–Ω–µ–π –ø–∞–Ω–µ–ª–∏
3. –û–±–Ω–æ–≤–∏—Ç–µ –≤ systemd unit

### –ü—Ä–æ–±–ª–µ–º–∞ 5: –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –≤—Å—ë —Ä–∞–≤–Ω–æ —à–∞–±–ª–æ–Ω–Ω—ã–µ

**–ü—Ä–∏—á–∏–Ω–∞:** YandexGPT –æ—Ç–∫–ª—é—á–∞–µ—Ç—Å—è –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö

**–†–µ—à–µ–Ω–∏–µ:**
1. –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ –≤ –ª–æ–≥–∞—Ö –µ—Å—Ç—å `üéâ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π —É—Å–ø–µ—à–Ω–æ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω`
2. –ï—Å–ª–∏ –Ω–µ—Ç ‚Äî –∏—â–∏—Ç–µ –æ—à–∏–±–∫–∏ –º–µ–∂–¥—É `üì° –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∑–∞–ø—Ä–æ—Å` –∏ —Ñ–∏–Ω–∞–ª–æ–º
3. –°–º–æ—Ç—Ä–∏—Ç–µ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—É—é –ø—Ä–∏—á–∏–Ω—É –æ—à–∏–±–∫–∏ –≤ –ª–æ–≥–∞—Ö

## –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. **–ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ –±–æ—Ç–∞:**
   ```bash
   sudo systemctl restart comapc-bot
   ```

2. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—é:**
   ```bash
   sudo journalctl -u comapc-bot -n 100 | grep -A 15 "–ü–†–û–í–ï–†–ö–ê YANDEX GPT"
   ```

3. **–ú–æ–Ω–∏—Ç–æ—Ä—å—Ç–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏:**
   ```bash
   sudo journalctl -u comapc-bot -f | grep --color=always -E "YANDEX GPT|YandexGPT|fallback"
   ```

4. **–ï—Å–ª–∏ –≤–∏–¥–∏—Ç–µ –æ—à–∏–±–∫–∏** ‚Äî —Å–º–æ—Ç—Ä–∏—Ç–µ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—É—é –ø—Ä–∏—á–∏–Ω—É –≤ –ª–æ–≥–∞—Ö –∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ä–µ—à–µ–Ω–∏—è –≤—ã—à–µ

5. **–°–æ–æ–±—â–∏—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç** ‚Äî –∫–∞–∫—É—é –∏–º–µ–Ω–Ω–æ –æ—à–∏–±–∫—É –∏–ª–∏ —Å–æ–æ–±—â–µ–Ω–∏–µ –≤—ã –≤–∏–¥–∏—Ç–µ –≤ –ª–æ–≥–∞—Ö

## –ü–æ–ª–µ–∑–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã

```bash
# –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ –±–æ—Ç–∞
sudo systemctl restart comapc-bot

# –°—Ç–∞—Ç—É—Å
sudo systemctl status comapc-bot

# –õ–æ–≥–∏ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
sudo journalctl -u comapc-bot -f

# –ü–æ—Å–ª–µ–¥–Ω–∏–µ 200 —Å—Ç—Ä–æ–∫
sudo journalctl -u comapc-bot -n 200

# –õ–æ–≥–∏ –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–π —á–∞—Å
sudo journalctl -u comapc-bot --since "1 hour ago"

# –¢–æ–ª—å–∫–æ –æ—à–∏–±–∫–∏
sudo journalctl -u comapc-bot -p err

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
sudo systemctl show comapc-bot -p Environment
```

